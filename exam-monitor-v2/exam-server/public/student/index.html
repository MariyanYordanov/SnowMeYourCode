<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Workspace - Exam Monitor v2</title>
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/student.css">
    <link rel="stylesheet" href="css/anti-cheat.css">
    
    <!-- Meta tags for security -->
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline' /socket.io/">
    <meta name="robots" content="noindex, nofollow">
    
    <!-- Disable cache during exam -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
</head>
<body class="exam-environment">
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h2>–ó–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –∏–∑–ø–∏—Ç–∞...</h2>
            <p>–ú–æ–ª—è –∏–∑—á–∞–∫–∞–π—Ç–µ...</p>
        </div>
    </div>

    <!-- Login Form -->
    <div id="login-container" class="login-container">
        <div class="login-form">
            <div class="login-header">
                <h1>üéì Exam Monitor v2</h1>
                <h2>–í—Ö–æ–¥ –∑–∞ –∏–∑–ø–∏—Ç</h2>
            </div>
            
            <form id="login-form" class="login-form-content">
                <div class="input-group">
                    <label for="student-name">–ò–º–µ –∏ —Ñ–∞–º–∏–ª–∏—è:</label>
                    <input 
                        type="text" 
                        id="student-name" 
                        placeholder="–í—ä–≤–µ–¥–µ—Ç–µ –∏–º–µ –∏ —Ñ–∞–º–∏–ª–∏—è"
                        required
                        autocomplete="off"
                        spellcheck="false"
                    >
                </div>
                
                <div class="input-group">
                    <label for="student-class">–ö–ª–∞—Å:</label>
                    <select id="student-class" required>
                        <option value="">–ò–∑–±–µ—Ä–µ—Ç–µ –∫–ª–∞—Å</option>
                        <option value="11–ê">11–ê</option>
                        <option value="11–ë">11–ë</option>
                        <option value="12–ê">12–ê</option>
                        <option value="12–ë">12–ë</option>
                    </select>
                </div>
                
                <button type="submit" id="login-btn" class="login-btn">
                    <span class="btn-text">–í–ª–µ–∑ –≤ –∏–∑–ø–∏—Ç–∞</span>
                    <span class="btn-spinner" style="display: none;">‚è≥</span>
                </button>
            </form>
            
            <div class="login-footer">
                <p class="exam-info">
                    üìù –í—Ä–µ–º–µ—Ç—Ä–∞–µ–Ω–µ: 3 —á–∞—Å–∞<br>
                    üõ°Ô∏è –°–∏—Å—Ç–µ–º–∞—Ç–∞ –Ω–∞–±–ª—é–¥–∞–≤–∞ –∑–∞ –Ω–∞—Ä—É—à–µ–Ω–∏—è<br>
                    ‚ö†Ô∏è –ù–µ –∑–∞—Ç–≤–∞—Ä—è–π—Ç–µ –±—Ä–∞—É–∑—ä—Ä–∞ –ø–æ –≤—Ä–µ–º–µ –Ω–∞ –∏–∑–ø–∏—Ç–∞
                </p>
            </div>
        </div>
    </div>

    <!-- Exam Workspace -->
    <div id="workspace-container" class="workspace-container hidden">
        <!-- Header -->
        <header class="workspace-header">
            <div class="header-left">
                <h1>üéì Exam Monitor</h1>
                <span id="student-info" class="student-info"></span>
            </div>
            
            <div class="header-center">
                <div id="exam-timer" class="exam-timer">
                    <span class="timer-label">–û—Å—Ç–∞–≤–∞—â–æ –≤—Ä–µ–º–µ:</span>
                    <span id="time-display" class="time-display">03:00:00</span>
                </div>
            </div>
            
            <div class="header-right">
                <div class="connection-status">
                    <div id="connection-indicator" class="status-indicator connected">
                        <span class="status-dot"></span>
                        <span class="status-text">–°–≤—ä—Ä–∑–∞–Ω</span>
                    </div>
                </div>
                
                <button id="complete-exam-btn" class="complete-exam-btn">
                    ‚úÖ –ü—Ä–∏–∫–ª—é—á–∏ –∏–∑–ø–∏—Ç–∞
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="workspace-main">
            <!-- File Explorer -->
            <aside class="file-explorer">
                <div class="explorer-header">
                    <h3>üìÅ –§–∞–π–ª–æ–≤–µ</h3>
                </div>
                <div class="file-tree">
                    <div class="file-item active" data-file="main.js">
                        <span class="file-icon">üìÑ</span>
                        <span class="file-name">main.js</span>
                    </div>
                    <!-- More files will be added dynamically -->
                </div>
            </aside>

            <!-- Code Editor -->
            <section class="editor-section">
                <div class="editor-header">
                    <div class="editor-tabs">
                        <div class="tab active" data-file="main.js">
                            <span class="tab-name">main.js</span>
                            <span class="tab-modified" style="display: none;">‚óè</span>
                        </div>
                    </div>
                    
                    <div class="editor-actions">
                        <button id="run-code-btn" class="action-btn">
                            ‚ñ∂Ô∏è –ò–∑–ø—ä–ª–Ω–∏
                        </button>
                        <button id="format-code-btn" class="action-btn">
                            üé® –§–æ—Ä–º–∞—Ç–∏—Ä–∞–π
                        </button>
                    </div>
                </div>
                
                <div class="editor-container">
                    <textarea 
                        id="code-editor" 
                        class="code-editor"
                        placeholder="// –ó–∞–ø–æ—á–Ω–µ—Ç–µ –¥–∞ –ø–∏—à–µ—Ç–µ –∫–æ–¥–∞ —Ç—É–∫...
console.log('Hello, World!');"
                        spellcheck="false"
                        autocomplete="off"
                    ></textarea>
                </div>
            </section>

            <!-- Preview/Output -->
            <aside class="preview-section">
                <div class="preview-header">
                    <div class="preview-tabs">
                        <button class="preview-tab active" data-tab="console">
                            üñ•Ô∏è –ö–æ–Ω–∑–æ–ª–∞
                        </button>
                        <button class="preview-tab" data-tab="preview">
                            üëÅÔ∏è –ü—Ä–µ–≥–ª–µ–¥
                        </button>
                    </div>
                    
                    <button id="clear-console-btn" class="action-btn">
                        üóëÔ∏è –ò–∑—á–∏—Å—Ç–∏
                    </button>
                </div>
                
                <div class="preview-content">
                    <div id="console-output" class="console-output active">
                        <div class="console-line welcome">
                            <span class="console-timestamp">[${new Date().toLocaleTimeString()}]</span>
                            <span class="console-message">–ö–æ–Ω–∑–æ–ª–∞—Ç–∞ –µ –≥–æ—Ç–æ–≤–∞</span>
                        </div>
                    </div>
                    
                    <div id="preview-output" class="preview-output">
                        <iframe id="preview-iframe" class="preview-iframe" sandbox="allow-scripts"></iframe>
                    </div>
                </div>
            </aside>
        </main>

        <!-- Footer -->
        <footer class="workspace-footer">
            <div class="footer-left">
                <span id="session-id" class="session-info"></span>
                <span class="separator">|</span>
                <span id="auto-save-status" class="auto-save-status">–ê–≤—Ç–æ–∑–∞–ø–∏—Å: –∞–∫—Ç–∏–≤–µ–Ω</span>
            </div>
            
            <div class="footer-center">
                <div id="progress-indicator" class="progress-indicator">
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 0%"></div>
                    </div>
                    <span class="progress-text">–ü—Ä–æ–≥—Ä–µ—Å: 0%</span>
                </div>
            </div>
            
            <div class="footer-right">
                <span class="version-info">v2.0.0</span>
            </div>
        </footer>
    </div>

    <!-- Fatal Error Screen -->
    <div id="error-screen" class="error-screen hidden">
        <div class="error-content">
            <div class="error-icon">‚ùå</div>
            <h2>–í—ä–∑–Ω–∏–∫–Ω–∞ –≥—Ä–µ—à–∫–∞</h2>
            <p id="error-message">–ù–µ–æ—á–∞–∫–≤–∞–Ω–∞ –≥—Ä–µ—à–∫–∞ –ø—Ä–∏ —Ä–∞–±–æ—Ç–∞ —Å –∏–∑–ø–∏—Ç–∞.</p>
            <div class="error-actions">
                <button onclick="location.reload()" class="error-btn primary">
                    üîÑ –ü—Ä–µ–∑–∞—Ä–µ–¥–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ç–∞
                </button>
                <button onclick="window.close()" class="error-btn secondary">
                    ‚ùå –ó–∞—Ç–≤–æ—Ä–∏
                </button>
            </div>
        </div>
    </div>

    <!-- Success/Completion Screen -->
    <div id="completion-screen" class="completion-screen hidden">
        <div class="completion-content">
            <div class="completion-icon">‚úÖ</div>
            <h2>–ò–∑–ø–∏—Ç—ä—Ç –µ –∑–∞–≤—ä—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ!</h2>
            <p>–í–∞—à–∞—Ç–∞ —Ä–∞–±–æ—Ç–∞ –µ –∑–∞–ø–∞–∑–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ.</p>
            <div class="completion-stats">
                <div class="stat">
                    <span class="stat-label">–í—Ä–µ–º–µ –∑–∞ —Ä–∞–±–æ—Ç–∞:</span>
                    <span id="work-duration" class="stat-value">--:--:--</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Session ID:</span>
                    <span id="final-session-id" class="stat-value">---</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="/socket.io/socket.io.js"></script>
    
    <!-- Module Scripts (ES6 Modules) -->
    <script type="module" src="js/main.js"></script>
    
    <!-- Fallback for older browsers -->
    <script nomodule>
        alert('–¢–æ–∑–∏ –±—Ä–∞—É–∑—ä—Ä –Ω–µ –ø–æ–¥–¥—ä—Ä–∂–∞ –º–æ–¥–µ—Ä–Ω–∏ JavaScript —Ñ—É–Ω–∫—Ü–∏–∏. –ú–æ–ª—è –∏–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ –ø–æ-–Ω–æ–≤ –±—Ä–∞—É–∑—ä—Ä (Chrome 61+, Firefox 60+, Safari 10.1+)');
    </script>

    <!-- Anti-cheat protection script -->
    <script>
        // Immediate anti-cheat measures before modules load
        
        // Disable right-click immediately
        document.addEventListener('contextmenu', e => e.preventDefault());
        
        // Disable F12 and other dev tools shortcuts
        document.addEventListener('keydown', e => {
            if (e.key === 'F12' || 
                (e.ctrlKey && e.shiftKey && e.key === 'I') ||
                (e.ctrlKey && e.shiftKey && e.key === 'J') ||
                (e.ctrlKey && e.key === 'U')) {
                e.preventDefault();
                console.warn('üö® Developer tools access blocked');
            }
        });
        
        // Detect developer tools (basic detection)
        let devtools = {open: false, orientation: null};
        setInterval(() => {
            if (window.outerHeight - window.innerHeight > 200 || 
                window.outerWidth - window.innerWidth > 200) {
                if (!devtools.open) {
                    devtools.open = true;
                    console.warn('üö® Developer tools detected');
                    // Will be handled by AntiCheat module when loaded
                }
            } else {
                devtools.open = false;
            }
        }, 500);
        
        // Hide loading screen when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                const loadingScreen = document.getElementById('loading-screen');
                if (loadingScreen) {
                    loadingScreen.style.opacity = '0';
                    setTimeout(() => loadingScreen.remove(), 500);
                }
            }, 1000);
        });
    </script>
</body>
</html>